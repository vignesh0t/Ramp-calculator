<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ramp Calculator</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FontAwesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- React & ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- Babel for JSX compilation -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

  <style>
    /* Prevent Blogger's default styles from messing with the app */
    #rampcalc-root {
      all: initial;
      font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    #rampcalc-root * {
      box-sizing: border-box;
    }
  </style>
</head>
<body>

<div id="rampcalc-root"></div>

<script type="text/babel">
  const { useState, useEffect, useRef } = React;

  function App() {
    const [unit, setUnit] = useState('mm');
    const [rise, setRise] = useState(300);
    const [run, setRun] = useState(3600);
    const [ratio, setRatio] = useState(12);
    const [calcMode, setCalcMode] = useState('find-length');

    // AI Feature States
    const [projectType, setProjectType] = useState('Commercial');
    const [isGenerating, setIsGenerating] = useState(false);
    const [aiReport, setAiReport] = useState('');
    const [dailyFact, setDailyFact] = useState('');

    // Chatbot States
    const [isChatOpen, setIsChatOpen] = useState(false);
    const [chatMessages, setChatMessages] = useState([
      { role: 'model', text: 'Hi! I am your Smart Architect Assistant. Ask me about compliance, handrails, materials, or your current ramp dimensions.' }
    ]);
    const [currentMessage, setCurrentMessage] = useState('');
    const [isChatLoading, setIsChatLoading] = useState(false);
    const chatEndRef = useRef(null);

    // Monetization States
    const [showProModal, setShowProModal] = useState(false);
    const [isStripeLoading, setIsStripeLoading] = useState(false);
    const [showLeadModal, setShowLeadModal] = useState(false);
    const [leadSubmitted, setLeadSubmitted] = useState(false);

    const units = {
      mm: { label: 'Millimeters', short: 'mm', toInches: 1 / 25.4 },
      cm: { label: 'Centimeters', short: 'cm', toInches: 1 / 2.54 },
      m: { label: 'Meters', short: 'm', toInches: 100 / 2.54 },
      in: { label: 'Inches', short: 'in', toInches: 1 },
      ft: { label: 'Feet', short: 'ft', toInches: 12 },
    };

    const angle = Math.atan(rise / run) * (180 / Math.PI);
    const rampLength = Math.sqrt(Math.pow(rise, 2) + Math.pow(run, 2));

    const handleRiseChange = (val) => {
      setRise(val);
      if (calcMode === 'find-length' && ratio > 0) {
        setRun(Number((val * ratio).toFixed(2)));
      } else if (calcMode === 'find-gradient' && val > 0) {
        setRatio(Number((run / val).toFixed(2)));
      }
    };

    const handleRunChange = (val) => {
      setRun(val);
      if (calcMode === 'find-gradient' && rise > 0) {
        setRatio(Number((val / rise).toFixed(2)));
      } else if (calcMode === 'find-height' && ratio > 0) {
        setRise(Number((val / ratio).toFixed(2)));
      }
    };

    const handleRatioChange = (val) => {
      setRatio(val);
      if (calcMode === 'find-length') {
        setRun(Number((rise * val).toFixed(2)));
      } else if (calcMode === 'find-height' && val > 0) {
        setRise(Number((run / val).toFixed(2)));
      }
    };

    const handleUnitChange = (e) => {
      const newUnit = e.target.value;
      const toInchesCurrent = units[unit].toInches;
      const fromInchesNew = 1 / units[newUnit].toInches;

      setRise(Number((rise * toInchesCurrent * fromInchesNew).toFixed(2)));
      setRun(Number((run * toInchesCurrent * fromInchesNew).toFixed(2)));
      setUnit(newUnit);
    };

    const isCompliant = angle <= 4.8;
    
    const riseInMm = rise * units[unit].toInches * 25.4;
    const runInMm = run * units[unit].toInches * 25.4;
    
    const needsLanding = riseInMm > 500 || runInMm > 6000; 

    useEffect(() => {
      const facts = [
        "Concrete is the most widely used material on Earth, second only to water.",
        "The Great Pyramid of Giza was the tallest man-made structure in the world for over 3,800 years.",
        "The term 'architect' comes from the Greek word 'arkhitekton', meaning chief builder.",
        "The Romans invented a self-healing concrete over 2,000 years ago using volcanic ash.",
        "It took roughly 22 million man-hours to build the Empire State Building in just 1 year and 45 days.",
        "The Golden Gate Bridge's famous 'International Orange' color was originally intended only as a primer.",
        "Steel is 100% recyclable and can be recycled repeatedly without losing its strength or quality.",
        "Singapore's Marina Bay Sands used over 85,000 tonnes of steel in its construction.",
        "The world's smallest skyscraper, the Newby-McMahon Building in Texas, is only 40 feet tall.",
        "Ancient builders used mortise and tenon joints to build Stonehenge without any metal fasteners."
      ];
      setDailyFact(facts[Math.floor(Math.random() * facts.length)]);
    }, []);

    useEffect(() => {
      if (isChatOpen && chatEndRef.current) {
        chatEndRef.current.scrollIntoView({ behavior: 'smooth' });
      }
    }, [chatMessages, isChatOpen]);

    // LOCAL "SMART" REPORT GENERATOR (No API required)
    const generateAIReport = () => {
      setIsGenerating(true);
      setAiReport('');
      
      // Simulate network thinking time
      setTimeout(() => {
        let report = `ARCHITECTURAL ACCESSIBILITY REPORT\nProject Type: ${projectType}\n\n`;
        
        report += `1. COMPLIANCE ANALYSIS:\n`;
        report += `- Current Gradient: 1:${ratio ? ratio.toFixed(1) : 'Unknown'} (${angle.toFixed(2)} degrees).\n`;
        if (isCompliant) {
          report += `- Status: COMPLIANT with standard 1:12 BCA guidelines for unassisted wheelchair use.\n`;
        } else {
          report += `- Status: NON-COMPLIANT. The gradient is too steep. Standard BCA maximum is 1:12 (~4.8 degrees).\n`;
        }
        if (needsLanding) {
          report += `- Critical Action: A level resting landing is REQUIRED because the continuous rise exceeds 500mm or the length exceeds 6000mm.\n`;
        } else {
          report += `- Run Limits: Acceptable continuous run without requiring an immediate mid-landing.\n`;
        }

        report += `\n2. DESIGN & SAFETY RECOMMENDATIONS:\n`;
        if (projectType === 'Commercial' || projectType === 'Industrial') {
          report += `- Handrails MUST be installed on both sides of the ramp for commercial/industrial safety.\n`;
          report += `- Provide Tactile Ground Surface Indicators (TGSIs) at the top and bottom of the ramp.\n`;
          report += `- Ensure a minimum clear width of 1200mm between handrails.\n`;
        } else if (projectType === 'Public Park') {
          report += `- Handrails are highly recommended on both sides due to exposure to weather.\n`;
          report += `- Edge protection (minimum 75mm high) must be provided if there is a drop-off.\n`;
        } else {
          report += `- Handrails are recommended for safety, especially for elderly users.\n`;
          report += `- Ensure the ramp ends with a flat clearance area of at least 1500mm x 1500mm.\n`;
        }

        report += `\n3. MATERIAL SUGGESTIONS:\n`;
        if (projectType === 'Public Park' || projectType === 'Industrial') {
           report += `- Surface: Use brushed concrete with deep grooving or textured aluminum grid plates to prevent slipping in heavy rain.\n`;
        } else {
           report += `- Surface: Non-slip outdoor tiles, brushed concrete, or commercial rubberized ramp mats are recommended to maintain grip.\n`;
        }

        setAiReport(report);
        setIsGenerating(false);
      }, 1200);
    };

    // LOCAL "SMART" CHATBOT (No API required)
    const handleSendMessage = (e) => {
      if (e) e.preventDefault();
      if (!currentMessage.trim() || isChatLoading) return;

      const userText = currentMessage;
      // Clean punctuation for better matching
      const lowerText = userText.toLowerCase().replace(/[^\w\s]/gi, ''); 
      
      const newUserMsg = { role: 'user', text: userText };
      setChatMessages(prev => [...prev, newUserMsg]);
      setCurrentMessage('');
      setIsChatLoading(true);

      // Simulate chat thinking time based on keywords
      setTimeout(() => {
        let reply = "";
        
        // Advanced Matchers
        const exact = (words) => words.some(w => new RegExp(`\\b${w}\\b`).test(lowerText));
        const flex = (words) => words.some(w => lowerText.includes(w));

        // Live contextual data
        const currentAngle = angle.toFixed(2);
        const currentRise = rise.toFixed(1) + units[unit].short;
        const currentRun = run.toFixed(1) + units[unit].short;
        const currentRatio = `1:${ratio ? ratio.toFixed(1) : '0'}`;

        if (exact(["hi", "hello", "hey", "greetings", "morning", "afternoon"])) {
          const greetings = ["Hello there!", "Hi!", "Greetings!"];
          reply = `${greetings[Math.floor(Math.random() * greetings.length)]} I see you're working on a ramp with a ${currentRatio} slope. Ask me anything about BCA compliance, handrails, or materials!`;
        }
        else if (flex(["thank", "appreciate", "awesome", "great", "good"])) {
          reply = "You're very welcome! Let me know if you want to test another set of measurements.";
        }
        else if (flex(["steep", "gradient", "angle", "slope", "ratio", "incline", "degree", "high", "long"])) {
          reply = isCompliant 
            ? `Your ramp sits at ${currentRatio} (${currentAngle}°). This is excellent! It is well within the standard BCA maximum limit of 1:12 (~4.8°), making it safe for unassisted wheelchair use.` 
            : `Careful! Your ramp is too steep. It is currently ${currentRatio} (${currentAngle}°), which exceeds the BCA maximum of 1:12 (~4.8°). You need to increase your 'Ramp Length' to make the incline gentler.`;
        } 
        else if (flex(["handrail", "rail", "railing", "grab bar", "support", "hold"])) {
          if (riseInMm > 175) {
            reply = `Since your ramp rises ${currentRise} (which is more than 175mm), **handrails are strictly required** on both sides under Singapore BCA rules. Ensure they are installed between 800mm and 900mm above the floor!`;
          } else {
            reply = `Your rise is quite low (${currentRise}), so handrails are technically optional under BCA rules. However, if this is for a ${projectType.toLowerCase()} space, I still highly recommend them for the safety of elderly users.`;
          }
        } 
        else if (flex(["landing", "rest", "platform", "flat", "turn", "stop", "midpoint"])) {
          if (needsLanding) {
            reply = `Yes, a landing is **mandatory** for this setup. Because your ramp run exceeds 6000mm or the rise exceeds 500mm, BCA code requires a level resting platform (at least 1200mm long) to give wheelchair users a break.`;
          } else {
            reply = `For your current dimensions (${currentRise} rise, ${currentRun} length), you do not need an intermediate resting landing! Just make sure you have flat clearance areas at the very top and bottom of the ramp.`;
          }
        } 
        else if (flex(["material", "surface", "slip", "wet", "concrete", "wood", "metal", "tile", "finish", "rain"])) {
          reply = `In Singapore's wet climate, slip resistance is critical! I highly recommend:\n- Deep-brushed concrete\n- Anti-slip porcelain tiles (R11 or R12 rating)\n- Textured aluminum plates\n\nAvoid smooth tiles or polished stone at all costs.`;
        } 
        else if (flex(["width", "wide", "narrow", "dimension", "size", "clearance"])) {
          reply = `Under BCA standards, a wheelchair ramp must have a minimum clear width of **1200mm** between the handrails. For high-traffic areas, going up to 1500mm is recommended!`;
        }
        else if (flex(["cost", "price", "expensive", "quote", "money", "pay", "fee", "estimate", "budget"])) {
          reply = `While I can't give an exact dollar amount for a ${currentRun} long ramp, commercial ramps typically cost between $150-$300 per square meter depending on the materials used. Click the 'Get Construction Quotes' button below to ask local contractors!`;
        }
        else if (flex(["formula", "calculate", "math", "equation", "how"])) {
          reply = `The math is based on simple trigonometry:\n- Gradient Ratio = Run ÷ Rise\n- Angle = arctan(Rise ÷ Run) × (180/π)\n\nFor your ramp, arctan(${rise} ÷ ${run}) = ${currentAngle}°.`;
        }
        else if (flex(["compliant", "pass", "bca", "ada", "safe", "compliance", "legal", "standard", "code", "approve", "requirement", "rule", "guide", "singapore"])) {
          reply = (isCompliant && !needsLanding) 
            ? `Good news! ✅ Your configuration (Slope: ${currentRatio}) passes the main Singapore BCA accessibility standards. It's safe and doesn't require a mid-landing.` 
            : `Currently, this design **does not pass** BCA standards. ⚠️\n${!isCompliant ? "- It is too steep (must be 1:12 or gentler)." : ""}\n${needsLanding ? "- It requires a resting landing (because rise > 500mm or length > 6000mm)." : ""}\n\nPlease adjust the measurements to fix these issues.`;
        }
        else {
          const fallbacks = [
            `That's an interesting question! Based on your current ramp (Angle: ${currentAngle}°), what specific accessibility feature are you wondering about? (e.g., handrails, slope, materials)`,
            `I'm mainly trained on ramp geometry and BCA compliance. Want to know if your ${currentRatio} gradient is safe?`,
            `I might not have the exact answer for that. But I can definitely tell you if your current ${currentRise} height needs a landing or handrails! Just ask.`
          ];
          reply = fallbacks[Math.floor(Math.random() * fallbacks.length)];
        }

        setChatMessages(prev => [...prev, { role: 'model', text: reply }]);
        setIsChatLoading(false);
      }, 800 + Math.random() * 600); // Randomize typing delay for realism
    };

    const maxVisualRise = 40;
    const maxVisualRun = 480;
    const visualHeightPct = Math.min(((riseInMm / 25.4) / maxVisualRise) * 100, 100);
    const visualWidthPct = Math.min(((runInMm / 25.4) / maxVisualRun) * 100, 100);

    return (
      <div className="bg-slate-950 text-slate-100 p-4 md:p-8 font-sans selection:bg-blue-500/30 rounded-xl">
        <div className="max-w-6xl mx-auto">
          {/* Header */}
          <header className="flex flex-col md:flex-row justify-between items-start md:items-center mb-12 gap-4">
            <div>
              <h1 className="text-4xl font-black tracking-tighter bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent flex items-center gap-3">
                <i className="fa-solid fa-chart-line text-blue-400 text-[32px]"></i>
                RAMP CALCULATOR
              </h1>
              <p className="text-slate-400 text-sm mt-1 font-medium">Interactive Accessibility Modeling</p>
            </div>
            <div className="flex gap-3 w-full md:w-auto">
              <button 
                onClick={() => window.print()}
                className="flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-2.5 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-sm font-bold shadow-[0_0_20px_rgba(37,99,235,0.3)] transition-all"
              >
                <i className="fa-solid fa-print text-[16px]"></i> Print Report
              </button>
            </div>
          </header>

          {/* Interesting Fact Banner */}
          {dailyFact && (
            <div className="mb-8 flex items-start sm:items-center gap-3 bg-indigo-900/20 border border-indigo-500/30 text-indigo-200 px-5 py-3.5 rounded-2xl text-sm font-medium">
              <i className="fa-solid fa-lightbulb text-indigo-400 text-[18px] shrink-0 mt-1 sm:mt-0"></i>
              <p><strong className="text-indigo-300">Did you know?</strong> {dailyFact}</p>
            </div>
          )}

          <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
            {/* Controls Card - Left Side */}
            <div className="lg:col-span-5 bg-slate-900 border border-slate-800 p-6 sm:p-8 rounded-3xl shadow-2xl flex flex-col gap-8">
              {/* Modes */}
              <div className="flex bg-slate-950 p-1.5 rounded-2xl border border-slate-800 overflow-x-auto">
                {[
                  { id: 'find-length', label: 'Find Length' },
                  { id: 'find-gradient', label: 'Find Gradient' },
                  { id: 'find-height', label: 'Find Height' }
                ].map((mode) => (
                  <button
                    key={mode.id}
                    onClick={() => setCalcMode(mode.id)}
                    className={`flex-1 py-2.5 px-2 rounded-xl text-xs sm:text-sm font-bold whitespace-nowrap transition-all duration-300 ${
                      calcMode === mode.id 
                        ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20' 
                        : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
                    }`}
                  >
                    {mode.label}
                  </button>
                ))}
              </div>

              <div className="space-y-8">
                {/* Unit Selector */}
                <div className="flex justify-between items-center bg-slate-950/50 p-3 rounded-2xl border border-slate-800">
                  <label className="text-xs font-bold text-slate-400 tracking-wider uppercase">Measurement Unit</label>
                  <select 
                    value={unit}
                    onChange={handleUnitChange}
                    className="bg-slate-900 border border-slate-700 text-slate-200 text-sm font-bold rounded-xl px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none transition-all cursor-pointer hover:border-slate-500"
                  >
                    {Object.entries(units).map(([key, { label }]) => (
                      <option key={key} value={key}>{label}</option>
                    ))}
                  </select>
                </div>

                {/* Gradient Ratio Input */}
                {(calcMode === 'find-length' || calcMode === 'find-height') && (
                  <div className="space-y-3">
                    <label className="text-xs font-bold text-slate-400 tracking-wider uppercase">
                      Gradient Rise (1:X Format)
                    </label>
                    <div className="relative flex items-center bg-slate-950 border border-slate-700 rounded-2xl overflow-hidden focus-within:ring-2 focus-within:ring-blue-500 focus-within:border-blue-500 transition-all">
                      <span className="pl-6 pr-4 py-4 text-3xl font-mono text-slate-500 font-bold bg-slate-900 border-r border-slate-800">1 :</span>
                      <input 
                        type="number" 
                        value={ratio || ''}
                        onChange={(e) => handleRatioChange(Number(e.target.value))}
                        className="w-full bg-transparent py-4 pl-4 pr-6 text-3xl font-mono outline-none text-slate-100 placeholder-slate-700"
                        placeholder="12"
                      />
                    </div>
                  </div>
                )}

                {/* Rise Input */}
                {(calcMode === 'find-length' || calcMode === 'find-gradient') && (
                  <div className="space-y-3">
                    <label className="text-xs font-bold text-slate-400 flex items-center gap-2 tracking-wider uppercase">
                      <i className="fa-solid fa-ruler text-blue-400 text-[16px]"></i> Height (Vertical Rise)
                    </label>
                    <div className="relative">
                      <input 
                        type="number" 
                        value={rise || ''}
                        onChange={(e) => handleRiseChange(Number(e.target.value))}
                        className="w-full bg-slate-950 border border-slate-700 rounded-2xl py-4 pl-6 pr-16 text-3xl font-mono focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all placeholder-slate-700"
                        placeholder="0"
                      />
                      <span className="absolute right-6 top-1/2 -translate-y-1/2 text-slate-500 font-mono font-bold">{units[unit].short}</span>
                    </div>
                  </div>
                )}

                {/* Run Input */}
                {(calcMode === 'find-gradient' || calcMode === 'find-height') && (
                  <div className="space-y-3">
                    <label className="text-xs font-bold text-slate-400 tracking-wider flex justify-between uppercase">
                      <span>Ramp Length</span>
                    </label>
                    <div className="relative">
                      <input 
                        type="number" 
                        value={run || ''}
                        onChange={(e) => handleRunChange(Number(e.target.value))}
                        className="w-full bg-slate-950 border border-slate-700 rounded-2xl py-4 pl-6 pr-16 text-3xl font-mono focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all placeholder-slate-700"
                        placeholder="0"
                      />
                      <span className="absolute right-6 top-1/2 -translate-y-1/2 text-slate-500 font-mono font-bold">{units[unit].short}</span>
                    </div>
                  </div>
                )}
              </div>
            </div>

            {/* Visualization & Results - Right Side */}
            <div className="lg:col-span-7 flex flex-col gap-6">
              
              {/* The Animated Ramp View */}
              <div className="bg-slate-900 border border-slate-800 rounded-3xl p-6 sm:p-8 h-[400px] relative overflow-hidden flex items-end justify-start group">
                <div className="absolute inset-0 opacity-10" style={{ backgroundImage: 'radial-gradient(circle at 1px 1px, #94a3b8 1px, transparent 0)', backgroundSize: '24px 24px' }} />
                
                {/* Ground Lines */}
                <div className="absolute bottom-24 left-24 right-12 h-1 bg-slate-800 rounded-full" />
                <div className="absolute bottom-24 left-24 w-1 h-[250px] bg-slate-800 rounded-full origin-bottom" />
                
                {/* Dynamic Ramp Polygon */}
                <div className="absolute bottom-[98px] left-[100px] right-16 h-[240px] flex items-end">
                  <div 
                    className={`relative origin-bottom-left transition-all duration-700 ease-out ${isCompliant ? 'bg-gradient-to-tr from-emerald-600/80 to-emerald-400/80' : 'bg-gradient-to-tr from-orange-600/80 to-orange-400/80'}`}
                    style={{
                      height: `${Math.max(visualHeightPct, 2)}%`,
                      width: `${Math.max(visualWidthPct, 5)}%`,
                      clipPath: 'polygon(0 100%, 100% 100%, 0 0)',
                    }}
                  >
                    <div className="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent" />
                  </div>
                  
                  {/* Gradient Ratio Indicator */}
                  <div className="absolute z-10 flex items-center justify-center transition-all duration-700" style={{ bottom: `${Math.max(visualHeightPct, 2) / 2}%`, left: `${Math.max(visualWidthPct, 5) / 2}%`, transform: 'translate(-50%, 50%)' }}>
                    <span className={`whitespace-nowrap font-mono text-xs px-2.5 py-1 rounded-lg border transition-all duration-500 shadow-lg ${calcMode === 'find-gradient' ? 'bg-blue-600 border-blue-400 text-white shadow-blue-500/50 font-bold scale-110 z-20' : 'bg-slate-900/90 border-slate-700 text-slate-400 backdrop-blur-sm'}`}>
                      1:{ratio ? ratio.toFixed(1) : '0'}
                    </span>
                  </div>

                  {/* Dotted line for Rise */}
                  <div className="absolute left-0 border-l-2 border-dashed border-slate-500/50 transition-all duration-700 flex items-center justify-center -ml-[2px]" style={{ height: `${Math.max(visualHeightPct, 2)}%`, bottom: 0 }}>
                    <span className={`absolute right-6 whitespace-nowrap font-mono text-xs px-2 py-1 rounded-lg border transition-all duration-500 flex flex-col items-center shadow-lg ${calcMode === 'find-height' ? 'bg-blue-600 border-blue-400 text-white shadow-blue-500/50 font-bold scale-110 z-20' : 'bg-slate-900 border-slate-800 text-slate-400'}`}>
                      <span className="text-[9px] uppercase tracking-wider opacity-70 mb-0.5">Height</span>
                      <span>{rise.toFixed(1)} {units[unit].short}</span>
                    </span>
                  </div>

                  {/* Dotted line for Run */}
                  <div className="absolute bottom-0 border-b-2 border-dashed border-slate-500/50 transition-all duration-700 flex items-center justify-center -mb-[2px]" style={{ width: `${Math.max(visualWidthPct, 5)}%`, left: 0 }}>
                    <span className={`absolute top-6 whitespace-nowrap font-mono text-xs px-2 py-1 rounded-lg border transition-all duration-500 flex flex-col items-center shadow-lg ${calcMode === 'find-length' ? 'bg-blue-600 border-blue-400 text-white shadow-blue-500/50 font-bold scale-110 z-20' : 'bg-slate-900 border-slate-800 text-slate-400'}`}>
                      <span className="text-[9px] uppercase tracking-wider opacity-70 mb-0.5">Length</span>
                      <span>{run.toFixed(1)} {units[unit].short}</span>
                    </span>
                  </div>
                </div>

                {/* Live Preview Badge */}
                <div className="absolute top-6 left-6 flex items-center gap-2 bg-slate-950/80 backdrop-blur-md px-4 py-2 rounded-full border border-slate-800 shadow-lg">
                  <div className="w-2.5 h-2.5 rounded-full bg-blue-500 animate-pulse" />
                  <span className="text-xs font-bold tracking-wider text-slate-300">LIVE GEOMETRY</span>
                </div>
              </div>

              {/* Results Grid */}
              <div className="grid grid-cols-3 gap-4">
                 <div className={`p-4 rounded-2xl border transition-colors duration-300 ${calcMode === 'find-height' ? 'bg-blue-900/20 border-blue-500/50 shadow-[0_0_15px_rgba(37,99,235,0.1)]' : 'bg-slate-900 border-slate-800'}`}>
                    <p className={`text-[10px] sm:text-xs font-bold uppercase tracking-wider mb-1 transition-colors ${calcMode === 'find-height' ? 'text-blue-400' : 'text-slate-500'}`}>Height</p>
                    <p className={`text-xl sm:text-2xl font-mono transition-colors ${calcMode === 'find-height' ? 'text-blue-300' : 'text-slate-200'}`}>
                      {rise.toFixed(1)} <span className="text-xs sm:text-sm opacity-50">{units[unit].short}</span>
                    </p>
                  </div>
                 <div className={`p-4 rounded-2xl border transition-colors duration-300 ${calcMode === 'find-length' ? 'bg-blue-900/20 border-blue-500/50 shadow-[0_0_15px_rgba(37,99,235,0.1)]' : 'bg-slate-900 border-slate-800'}`}>
                    <p className={`text-[10px] sm:text-xs font-bold uppercase tracking-wider mb-1 transition-colors ${calcMode === 'find-length' ? 'text-blue-400' : 'text-slate-500'}`}>Length</p>
                    <p className={`text-xl sm:text-2xl font-mono transition-colors ${calcMode === 'find-length' ? 'text-blue-300' : 'text-slate-200'}`}>
                      {run.toFixed(1)} <span className="text-xs sm:text-sm opacity-50">{units[unit].short}</span>
                    </p>
                  </div>
                  <div className={`p-4 rounded-2xl border transition-colors duration-300 ${calcMode === 'find-gradient' ? 'bg-blue-900/20 border-blue-500/50 shadow-[0_0_15px_rgba(37,99,235,0.1)]' : 'bg-slate-900 border-slate-800'}`}>
                    <p className={`text-[10px] sm:text-xs font-bold uppercase tracking-wider mb-1 transition-colors ${calcMode === 'find-gradient' ? 'text-blue-400' : 'text-slate-500'}`}>Gradient</p>
                    <p className={`text-xl sm:text-2xl font-mono transition-colors ${calcMode === 'find-gradient' ? 'text-blue-300' : 'text-slate-200'}`}>
                      1 : {ratio ? ratio.toFixed(1) : '0'}
                    </p>
                  </div>
              </div>

              {/* Final Assessment Banner */}
              <div className={`p-6 rounded-3xl border-2 transition-colors duration-500 ${isCompliant && !needsLanding ? 'border-emerald-500/20 bg-emerald-500/5' : 'border-orange-500/20 bg-orange-500/5'}`}>
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                  <div className="flex items-start gap-4">
                    <div className={`p-2 rounded-full mt-1 ${isCompliant && !needsLanding ? 'bg-emerald-500/20 text-emerald-400' : 'bg-orange-500/20 text-orange-400'}`}>
                      {isCompliant && !needsLanding ? <i className="fa-solid fa-circle-check text-[24px]"></i> : <i className="fa-solid fa-triangle-exclamation text-[24px]"></i>}
                    </div>
                    <div>
                      <h3 className="text-lg font-bold text-slate-200 mb-1">
                        {isCompliant && !needsLanding ? 'BCA Compliant Design' : 'Review Required'}
                      </h3>
                      <p className="text-sm text-slate-400 max-w-md">
                        {!isCompliant 
                          ? "The slope exceeds standard BCA maximums (1:12 or ~4.8°). This may require assistance to navigate." 
                          : needsLanding 
                          ? "Slope is fine, but BCA Code requires a resting platform for any single run exceeding 500mm in rise or 6000mm in length."
                          : "This ramp configuration meets standard BCA (Singapore) requirements for unassisted wheelchair accessibility."}
                      </p>
                    </div>
                  </div>
                  
                  <div className={`px-4 py-2 rounded-xl text-sm font-bold tracking-wide border ${isCompliant && !needsLanding ? 'bg-emerald-500/10 text-emerald-400 border-emerald-500/20' : 'bg-orange-500/10 text-orange-400 border-orange-500/20'}`}>
                    {isCompliant && !needsLanding ? 'PASSED' : 'WARNING'}
                  </div>
                </div>

                {/* Lead Generation Button */}
                <div className="mt-6 pt-5 border-t border-slate-800/50 flex flex-col sm:flex-row justify-between items-center gap-4">
                  <p className="text-sm text-slate-400 flex items-center gap-2">
                    <i className="fa-solid fa-helmet-safety text-slate-500 text-[16px]"></i> Ready to build this ramp?
                  </p>
                  <button onClick={() => setShowLeadModal(true)} className="w-full sm:w-auto px-5 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 border border-slate-700 text-sm font-bold text-slate-200 transition-all flex items-center justify-center gap-2 hover:shadow-lg">
                    Get Quotes from Local BCA Contractors
                  </button>
                </div>
              </div>

              {/* AI Generator Section (Now running locally!) */}
              <div className="bg-slate-900 border border-slate-800 rounded-3xl p-6 relative overflow-hidden flex flex-col gap-4">
                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 border-b border-slate-800 pb-4">
                  <div className="flex items-center gap-3">
                    <div className="p-2 bg-blue-600/20 rounded-xl border border-blue-500/30">
                      <i className="fa-solid fa-wand-magic-sparkles text-blue-400 text-[20px]"></i>
                    </div>
                    <div>
                      <h3 className="text-sm font-bold text-slate-200">Smart Architect Report</h3>
                      <p className="text-xs text-slate-500">Get tailored material & safety advice</p>
                    </div>
                  </div>
                  
                  <div className="flex items-center gap-3 w-full sm:w-auto">
                    <div className="relative flex-1 sm:w-40">
                      <div className="absolute inset-y-0 left-3 flex items-center pointer-events-none">
                        <i className="fa-solid fa-building text-slate-500 text-[14px]"></i>
                      </div>
                      <select value={projectType} onChange={(e) => setProjectType(e.target.value)} className="w-full bg-slate-950 border border-slate-700 text-slate-300 text-xs font-bold rounded-xl pl-9 pr-3 py-2.5 outline-none focus:ring-2 focus:ring-blue-500 appearance-none">
                        <option value="Commercial">Commercial</option>
                        <option value="Residential">Residential</option>
                        <option value="Public Park">Public Park</option>
                        <option value="Industrial">Industrial</option>
                      </select>
                    </div>
                    
                    <button onClick={generateAIReport} disabled={isGenerating} className="flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white text-xs font-bold py-2.5 px-4 rounded-xl shadow-[0_0_15px_rgba(79,70,229,0.3)] transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap">
                      {isGenerating ? <i className="fa-solid fa-spinner fa-spin text-[16px]"></i> : <i className="fa-solid fa-wand-magic-sparkles text-[16px]"></i>}
                      <span>{isGenerating ? 'Analyzing...' : 'Generate ✨'}</span>
                    </button>
                  </div>
                </div>

                {aiReport && (
                  <div className="relative bg-slate-950/50 rounded-xl p-5 border border-slate-800 mt-2">
                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-indigo-500 to-emerald-500 rounded-t-xl opacity-50" />
                    <pre className="text-sm text-slate-300 whitespace-pre-wrap font-sans leading-relaxed">{aiReport}</pre>
                  </div>
                )}
                {!aiReport && !isGenerating && (
                  <div className="text-center py-6 text-slate-500 text-sm border border-dashed border-slate-700/50 rounded-xl bg-slate-950/20">
                    Select your project type and click generate for a custom architectural breakdown.
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>

        {/* Floating Chatbot Widget (Now running locally!) */}
        <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end">
          <div className={`transition-all duration-300 origin-bottom-right ${isChatOpen ? 'scale-100 opacity-100 mb-4' : 'scale-0 opacity-0 h-0 w-0 overflow-hidden'}`}>
            <div className="bg-slate-900 border border-slate-700 shadow-2xl rounded-2xl w-80 sm:w-96 flex flex-col h-[500px] max-h-[75vh] overflow-hidden">
              <div className="bg-slate-800 p-4 border-b border-slate-700 flex justify-between items-center">
                <div className="flex items-center gap-3">
                  <div className="p-2 bg-blue-600/20 rounded-lg">
                    <i className="fa-solid fa-message text-blue-400 text-[18px]"></i>
                  </div>
                  <div>
                    <h3 className="text-sm font-bold text-slate-200 leading-tight">Smart Architect</h3>
                    <p className="text-[10px] text-emerald-400 font-medium flex items-center gap-1.5 mt-0.5">
                      <span className="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse" /> Online
                    </p>
                  </div>
                </div>
                <button onClick={() => setIsChatOpen(false)} className="text-slate-400 hover:text-white transition-colors bg-slate-700/50 hover:bg-slate-700 p-1.5 rounded-lg">
                  <i className="fa-solid fa-xmark text-[18px]"></i>
                </button>
              </div>

              <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-950/50 scroll-smooth">
                {chatMessages.map((msg, idx) => (
                  <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                    <div className={`max-w-[85%] rounded-2xl px-4 py-2.5 text-sm shadow-md ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-br-sm' : 'bg-slate-800 text-slate-200 border border-slate-700 rounded-bl-sm'}`}>
                      <p className="whitespace-pre-wrap leading-relaxed">{msg.text}</p>
                    </div>
                  </div>
                ))}
                {isChatLoading && (
                  <div className="flex justify-start">
                    <div className="max-w-[85%] rounded-2xl px-4 py-3 bg-slate-800 border border-slate-700 rounded-bl-sm flex items-center gap-1.5 shadow-md">
                      <span className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                      <span className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
                      <span className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
                    </div>
                  </div>
                )}
                <div ref={chatEndRef} />
              </div>

              <form onSubmit={handleSendMessage} className="p-3 border-t border-slate-700 bg-slate-900">
                <div className="relative flex items-center">
                  <input type="text" value={currentMessage} onChange={(e) => setCurrentMessage(e.target.value)} placeholder="Ask about your ramp..." className="w-full bg-slate-950 border border-slate-700 rounded-xl py-3 pl-4 pr-12 text-sm text-slate-200 outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-slate-500 shadow-inner" />
                  <button type="submit" disabled={!currentMessage.trim() || isChatLoading} className="absolute right-1.5 p-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-800 disabled:text-slate-500 text-white rounded-lg transition-colors shadow-sm">
                    <i className="fa-solid fa-paper-plane text-[16px]"></i>
                  </button>
                </div>
              </form>
            </div>
          </div>

          <button onClick={() => setIsChatOpen(!isChatOpen)} className={`p-4 rounded-full shadow-2xl transition-all duration-300 flex items-center gap-2 border ${isChatOpen ? 'bg-slate-800 text-slate-400 hover:text-white border-slate-700' : 'bg-gradient-to-r from-blue-600 to-indigo-600 text-white border-transparent hover:shadow-[0_0_20px_rgba(79,70,229,0.5)] hover:scale-105'}`}>
            {isChatOpen ? <i className="fa-solid fa-xmark text-[24px]"></i> : <i className="fa-solid fa-message text-[24px]"></i>}
            {!isChatOpen && <span className="font-bold text-sm hidden sm:block pr-1">Ask Assistant</span>}
          </button>
        </div>

        {/* --- MONETIZATION MODALS --- */}
        {showProModal && (
          <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm animate-in fade-in duration-300">
            <div className="bg-slate-900 border border-slate-700 rounded-3xl max-w-md w-full p-6 shadow-2xl relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-indigo-500" />
              <button onClick={() => setShowProModal(false)} className="absolute top-4 right-4 text-slate-400 hover:text-white bg-slate-800 rounded-full p-1 transition-colors">
                <i className="fa-solid fa-xmark text-[20px]"></i>
              </button>
              
              <div className="text-center mt-4 mb-6">
                <div className="w-16 h-16 bg-blue-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-blue-500/20 shadow-[0_0_30px_rgba(37,99,235,0.2)]">
                  <i className="fa-solid fa-lock text-blue-400 text-[32px]"></i>
                </div>
                <h2 className="text-2xl font-black text-white">Unlock Ramp Calculator <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400">PRO</span></h2>
                <p className="text-slate-400 text-sm mt-2">Generate professional PDF reports, unlock unlimited AI chats, and save your projects to the cloud.</p>
              </div>

              <div className="bg-slate-950 rounded-2xl p-5 mb-6 border border-slate-800">
                <div className="flex items-end gap-1 mb-4">
                  <span className="text-3xl font-black text-white">$9</span>
                  <span className="text-slate-500 font-medium mb-1">/ month</span>
                </div>
                <ul className="space-y-3">
                  {['Export branded PDF reports', 'Unlimited AI Architect insights', 'Save & manage multiple projects', 'Priority email support'].map((feature, i) => (
                    <li key={i} className="flex items-center gap-3 text-sm text-slate-300">
                      <i className="fa-solid fa-circle-check text-emerald-500 text-[16px] shrink-0"></i> {feature}
                    </li>
                  ))}
                </ul>
              </div>

              <button onClick={() => { setIsStripeLoading(true); setTimeout(() => { setIsStripeLoading(false); setShowProModal(false); }, 2000); }} disabled={isStripeLoading} className="w-full py-3.5 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold shadow-lg transition-all flex items-center justify-center gap-2">
                {isStripeLoading ? <i className="fa-solid fa-spinner fa-spin text-[18px]"></i> : <i className="fa-solid fa-credit-card text-[18px]"></i>}
                {isStripeLoading ? 'Redirecting to Stripe...' : 'Upgrade with Stripe'}
              </button>
              <p className="text-center text-xs text-slate-500 mt-4">Secure, encrypted payment. Cancel anytime.</p>
            </div>
          </div>
        )}

        {showLeadModal && (
          <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-950/80 backdrop-blur-sm animate-in fade-in duration-300">
            <div className="bg-slate-900 border border-slate-700 rounded-3xl max-w-md w-full p-6 shadow-2xl relative">
              <button onClick={() => { setShowLeadModal(false); setLeadSubmitted(false); }} className="absolute top-4 right-4 text-slate-400 hover:text-white bg-slate-800 rounded-full p-1 transition-colors">
                <i className="fa-solid fa-xmark text-[20px]"></i>
              </button>

              {!leadSubmitted ? (
                <React.Fragment>
                  <div className="mb-6">
                    <div className="w-12 h-12 bg-emerald-500/10 rounded-2xl flex items-center justify-center mb-4 border border-emerald-500/20">
                      <i className="fa-solid fa-helmet-safety text-emerald-400 text-[24px]"></i>
                    </div>
                    <h2 className="text-xl font-bold text-white">Get Construction Quotes</h2>
                    <p className="text-slate-400 text-sm mt-1">We'll connect you with up to 3 BCA-certified contractors to build your {run.toFixed(1)}{units[unit].short} ramp.</p>
                  </div>

                  <form className="space-y-4" onSubmit={(e) => { e.preventDefault(); setLeadSubmitted(true); }}>
                    <div className="space-y-1.5">
                      <label className="text-xs font-bold text-slate-400 uppercase">Full Name</label>
                      <div className="relative">
                        <i className="fa-solid fa-user absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-[16px]"></i>
                        <input required type="text" className="w-full bg-slate-950 border border-slate-700 rounded-xl py-2.5 pl-10 pr-4 text-sm text-slate-200 outline-none focus:border-blue-500 transition-colors" placeholder="John Doe" />
                      </div>
                    </div>
                    <div className="space-y-1.5">
                      <label className="text-xs font-bold text-slate-400 uppercase">Email Address</label>
                      <div className="relative">
                        <i className="fa-solid fa-envelope absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-[16px]"></i>
                        <input required type="email" className="w-full bg-slate-950 border border-slate-700 rounded-xl py-2.5 pl-10 pr-4 text-sm text-slate-200 outline-none focus:border-blue-500 transition-colors" placeholder="john@example.com" />
                      </div>
                    </div>
                    <div className="space-y-1.5">
                      <label className="text-xs font-bold text-slate-400 uppercase">Phone Number</label>
                      <div className="relative">
                        <i className="fa-solid fa-phone absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 text-[16px]"></i>
                        <input required type="tel" className="w-full bg-slate-950 border border-slate-700 rounded-xl py-2.5 pl-10 pr-4 text-sm text-slate-200 outline-none focus:border-blue-500 transition-colors" placeholder="+65 8123 4567" />
                      </div>
                    </div>
                    
                    <button type="submit" className="w-full mt-4 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white font-bold shadow-lg transition-all">
                      Request Free Quotes
                    </button>
                    <p className="text-center text-xs text-slate-500 mt-2">By submitting, you agree to share your details with our partner contractors.</p>
                  </form>
                </React.Fragment>
              ) : (
                <div className="text-center py-8 animate-in zoom-in duration-300">
                  <div className="w-20 h-20 bg-emerald-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                    <i className="fa-solid fa-check text-emerald-500 text-[40px]"></i>
                  </div>
                  <h2 className="text-2xl font-bold text-white mb-2">Request Sent!</h2>
                  <p className="text-slate-400 text-sm mb-6">Your ramp details have been sent to our partner network. You will receive quotes shortly.</p>
                  <button onClick={() => { setShowLeadModal(false); setLeadSubmitted(false); }} className="px-6 py-2.5 rounded-xl bg-slate-800 hover:bg-slate-700 text-white font-bold transition-all">
                    Close Window
                  </button>
                </div>
              )}
            </div>
          </div>
        )}
      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById('rampcalc-root'));
  root.render(<App />);
</script>

</body>
</html>
